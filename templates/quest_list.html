{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<style>
  .quest-container {
    max-width: 700px;
    margin: 0 auto;
    padding: 2em 1em;
  }
  h1 {
    text-align: center;
    color: #5A8DEE;
    margin-bottom: 1em;
  }
  .user-type {
    text-align: center;
    font-weight: bold;
    color: #333;
    margin-bottom: 2em;
  }
  .user-type span {
    color: #5A8DEE;
  }

  form.filter-form {
    text-align: center;
    margin-bottom: 2em;
  }
  input[type="text"],
  select {
    font-size: 1em;
    padding: 0.5em;
    margin-right: 0.5em;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button {
    padding: 0.5em 1em;
    background: #5A8DEE;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover {
    background-color: #4169e1;
  }

  ul {
    list-style: none;
    padding: 0;
  }
  li {
    background: #fff;
    border-radius: 10px;
    border: 1px solid #ddd;
    margin-bottom: 1.5em;
    padding: 1.2em;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  .quest-title {
    font-size: 1.1em;
    font-weight: bold;
    color: #333;
    margin-bottom: 0.3em;
  }

  .quest-meta {
    font-size: 0.85em;
    margin-bottom: 0.6em;
  }

  .tag {
    display: inline-block;
    padding: 0.2em 0.6em;
    border-radius: 999px;
    margin-right: 0.4em;
    margin-bottom: 0.2em;
    font-size: 0.8em;
    border: 1px solid transparent;
  }

  .tag-type {
    background-color: #eef2ff;
    color: #334155;
    border-color: #c7d2fe;
  }

  .tag-status {
    background-color: #f1f5f9;
    color: #0f172a;
    border-color: #cbd5f5;
  }

  .status-not-started {
    background-color: #fef2f2;
    color: #991b1b;
    border-color: #fecaca;
  }
  .status-in-progress {
    background-color: #fffbeb;
    color: #92400e;
    border-color: #fde68a;
  }
  .status-completed {
    background-color: #ecfdf3;
    color: #166534;
    border-color: #bbf7d0;
  }

  .badge-recommended {
    background-color: #fef3c7;
    color: #92400e;
    border-color: #fcd34d;
  }
  .badge-common {
    background-color: #e5e7eb;
    color: #111827;
    border-color: #d1d5db;
  }

  .quest-description {
    margin: 0.8em 0;
    color: #444;
  }

  .btn {
    display: inline-block;
    padding: 0.5em 1.2em;
    background-color: #5A8DEE;
    color: white;
    border-radius: 8px;
    text-decoration: none;
    margin-top: 1em;
  }
  .btn:hover {
    background-color: #4169e1;
  }
</style>

<div class="quest-container">
  <h1>{{ title }}</h1>

  {% if user_type %}
    <p class="user-type">ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ã¯ {{ type_info.get(user_type, {}).get("name", "æœªè¨ºæ–­") }} ã§ã™
</p>
  {% endif %}

  <form method="get" class="filter-form">
    <input type="text" name="search" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢"
           value="{{ request.args.get('search', '') }}">
    <select name="filter">
      <option value="">-- å…¨ã¦è¡¨ç¤º --</option>
      {% for key, label in type_labels.items() %}
        <option value="{{ key }}"
          {% if request.args.get('filter') == key %}selected{% endif %}>
          {{ label }}
        </option>
      {% endfor %}
    </select>
    <button type="submit">ğŸ” æ¤œç´¢</button>
  </form>

  <ul>
    {% for q in quests %}

      {# ---- å¯¾è±¡ã‚¿ã‚¤ãƒ—ã®ãƒ©ãƒ™ãƒ« ---- #}
      {% set type_key = q["type"]|default("") %}
      {% set base_label = type_labels[type_key]|default("ãã®ä»–") %}

      {% if type_key == "all" %}
        {% set type_label = "å…¨ã‚¿ã‚¤ãƒ—å‘ã‘" %}
      {% else %}
        {% set type_label = base_label ~ "å‘ã‘" %}
      {% endif %}

      {# ---- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæœªæŒ‘æˆ¦ / æŒ‘æˆ¦ä¸­ / ã‚¯ãƒªã‚¢æ¸ˆã¿ï¼ï¼‰ ---- #}
      {% set status = q["status"]|default("not_started") %}

      <li>
        <div class="quest-title">
          {{ q["title"] }}
        </div>

        <div class="quest-meta">
          <!-- å¯¾è±¡ã‚¿ã‚¤ãƒ—è¡¨ç¤ºï¼šã€Œå…¨ã‚¿ã‚¤ãƒ—å‘ã‘ã€ã€Œâ—‹â—‹å‘ã‘ã€ -->
          <span class="tag tag-type">{{ type_label }}</span>

          <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ãƒãƒƒãƒãƒ³ã‚°ï¼ˆãŠã™ã™ã‚ / å…¨ã‚¿ã‚¤ãƒ—å‘ã‘ï¼‰ -->
          {% if user_type and type_key|trim == user_type|trim %}
            <span class="tag badge-recommended">ğŸŒŸ ã‚ãªãŸã«ãŠã™ã™ã‚ï¼</span>
          {% elif type_key == "all" %}
            <span class="tag badge-common">ğŸŒ± å…¨ã‚¿ã‚¤ãƒ—å‘ã‘</span>
          {% endif %}

          <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
          <span class="tag tag-status
            {% if status == 'not_started' %} status-not-started
            {% elif status == 'in_progress' %} status-in-progress
            {% elif status == 'completed' %} status-completed
            {% endif %}
          ">
            {% if status == 'not_started' %}
              æœªæŒ‘æˆ¦
            {% elif status == 'in_progress' %}
              æŒ‘æˆ¦ä¸­
            {% elif status == 'completed' %}
              ã‚¯ãƒªã‚¢æ¸ˆã¿ï¼
            {% else %}
              æœªæŒ‘æˆ¦
            {% endif %}
          </span>
        </div>

        <div class="quest-description">
          {{ q["description"] or "ï¼ˆèª¬æ˜ãªã—ï¼‰" }}
        </div>

        <a href="/quest/{{ q['id'] }}" class="btn">
          ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã«æŒ‘æˆ¦ã™ã‚‹
        </a>
      </li>

    {% else %}
      <li style="text-align:center; color:gray;">
        è©²å½“ã™ã‚‹ã‚¯ã‚¨ã‚¹ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
      </li>
    {% endfor %}
  </ul>

  <div style="text-align: center;">
    <a href="/quest" class="btn">â† ã‚¯ã‚¨ã‚¹ãƒˆé¸æŠã«æˆ»ã‚‹</a>
  </div>
</div>
{% endblock %}
